---
title: 'DATA 608: Homework 1 (Baseball Regression)'
author: "Shoshanna Farber, Josh Forster, Glen Davis, Andrew Bowen, Charles Ugiagbe"
date: "2023-09-04"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE, message=FALSE}
library(glue)
library(tidyverse)
library(car)
```
First, let's read in the provided dataset
```{r data-read-in, echo=FALSE, message=FALSE}
df <- read.csv("https://raw.githubusercontent.com/andrewbowen19/businessAnalyticsDataMiningDATA621/main/data/moneyball-training-data.csv")
df <- data.frame(df)
```


## Data Exploration

First, let's print out some summary statistics. We're primarily interested in the `TARGET_WINS` feature, so we'll look at that first
```{r echo=FALSE, message=FALSE}
mean_wins <- mean(df$TARGET_WINS)
median_wins <- median(df$TARGET_WINS)
sd_wins <- sd(df$TARGET_WINS)

# Print summary stats
print(glue("The mean number of wins in a season is {mean_wins}"))
print(glue("The median number of wins in a season is {median_wins}"))
print(glue("The standard deviation for number of wins in a season is {sd_wins}"))
```

Let's also make a boxplot and histogram of the `TARGET_WINS` variable. This should give us a sense of the distribution of wins for teams/seasons in our population

```{r wins-hist, echo=FALSE, message=FALSE}
ggplot(df, aes(x=TARGET_WINS)) + geom_histogram()
```

Overall, the number of wins in a season for a given baseball team looks fairly normally distributed. We can also plot this distribution via a boxplot, which helps to highlight outliers.


```{r echo=FALSE}
ggplot(df, aes(x=TARGET_WINS)) + geom_boxplot()
```


Let's look at raw correlations between our other included variables and a team's win total for a season: 

```{r basic-correlations, echo=FALSE, message=FALSE}
train <- subset(df, select=-c(INDEX))
cor(train, df$TARGET_WINS)
```

Let's make a basic model with all inputs
```{r scatter-plots, echo=FALSE, message=FALSE}
lm_all <- lm(TARGET_WINS~., train)
coef(lm_all)
```


We can make some plots to help test our assumptions of our basic model using the `plot` function on our model variable




```{r echo=FALSE, message=FALSE}
plot(lm_all)
```



Now we can make a model with inputs that we know from baseball.

- Total hits (`TEAM_BATTING_H`)
- Total walks gained (`TEAM_BATTING_BB`)
- Total hits allowed (`TEAM_PITCHING_H`)
- Total walks allowed (`TEAM_PITCHING_BB`)

The thinking being here that good teams generally tend to get on base more frequently (`TEAM_BATTING_HITS` and `TEAM_BATTING_BB`) while allowing *fewer* runners on base (Negative predictor variables `TEAM_PITCHING_H` and `TEAM_PITCHING_BB`)
```{r lm-select, echo=FALSE, message=FALSE}

# Create model with select inputs (walks and hits allowed/gained)
lm_select <- lm(TARGET_WINS ~ TEAM_BATTING_H + TEAM_BATTING_BB + TEAM_PITCHING_H + TEAM_PITCHING_BB, train)

summary(lm_select)
```


```{r plot-lm-select, echo=FALSE, message=FALSE}
plot(lm_select)
```


It's interesting to not that with selected variables (walks and hits gained/allowed per team) that our adjusted $R^2$ actually went *down*, indicating the amount of variability in `TARGET_WINS` explained by our more selective walks/hits model is *less* than the model including all variables.

Looking at our residual plot above, there seems to be a clustering of residuals along the x-axis at $X \approx 80$. This shows a pattern in our residuals

```{r plot-lm-select-residuals, echo=FALSE, message=FALSE}

# Plot selective model residuals
plot(lm_select$residuals)

```

Let's plot our response variable (*Total Wins*) versus each of our predictor variables to get a sense of linear relationships

```{r plot-select-vars, echo=FALSE, message=FALSE}

# Plot our response variable for each predictor variable to get a sense of
plot(TARGET_WINS ~ TEAM_BATTING_H + TEAM_BATTING_BB + TEAM_PITCHING_H + TEAM_PITCHING_BB, data=train)

```







## Model Evaluation
```{r echo=FALSE}
eval_data_url <- "https://raw.githubusercontent.com/andrewbowen19/businessAnalyticsDataMiningDATA621/main/data/moneyball-evaluation-data.csv"

test <- read.csv(eval_data_url)
```


```{r}
predict(lm_all, test)
```

# Appendix: Report Code

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```




## Model Evaluation
We'll need to read in our [evaluation data](https://github.com/andrewbowen19/businessAnalyticsDataMiningDATA621/blob/main/data/moneyball-evaluation-data.csv), which is hosted on GitHub for reproduceability. 

```{r echo=FALSE}
eval_data_url <- "https://raw.githubusercontent.com/andrewbowen19/businessAnalyticsDataMiningDATA621/main/data/moneyball-evaluation-data.csv"

test <- read.csv(eval_data_url)
```




# Appendix: Report Code
Below is the code for this report to generate the models and charts above

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

