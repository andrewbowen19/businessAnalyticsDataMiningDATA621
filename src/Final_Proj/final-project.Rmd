---
title             : "An Analysis of the Department of Education Quality Survey and Its Efficacy"
shorttitle        : "DATA621 Final Project"

author: 
  - name          : "Andrew Bowen"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    email         : "andrew.bowen08@spsmail.cuny.edu"
  - name          : "Glen Dale Davis"
    affiliation   : "1"
  - name: "Josh Forster"
    affiliation: "1"
  - name: "Shoshana Farber"
    affiliation: "1"
  - name: "Charles Ugiagbe"
    affiliation: "1"

affiliation:
  - id            : "1"
    institution   : "City University of New York"


abstract: |
  Abstract coming soon!
  
  
keywords          : "Educational Outcomes, School Quality, Education"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : no
draft             : no
mask              : no
figurelist        : no
tablelist         : no
footnotelist      : no
classoption       : "man"
output            : papaja::apa6_pdf
---
```{r setup-knitr, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r setup, include = FALSE, echo=FALSE, message=FALSE}
library(tidyverse)
library(gridExtra)
library(glue)
library("papaja")
r_refs("r-references.bib")
```


# Introduction
The NYC School Survey seeks to collect data to provide an overview of New York City Schools. Beginning in 2005, the survey looks to collect demographic and achievement data for New York City Public Schools, and provide a standardized rating of various elements of school quality. 

The survey has changed over the years. This change has come from recommendations of public policy analysts in order to more accurately define the quality of schools *@redesign-school-survey*. The 2020-21 academic year report provides a robust dataset defined at the school level with academic and socioeconomic data provided. 



**Research Question:** This study aims to determine whether the school ratings within the NYC School Quality Survey accurately reflect educational outcomes, or if other variables related to certain schools can be used as a better proxy.

# Literature Review
Measuring the input variables that impact educational outcomes is a difficult task. With so many confounding variables, it can be difficult to determine direct causal relationships that have an outsized impact 


# Data Sourcing

- [School Quality NYC 2020 - 2021](https://data.cityofnewyork.us/Education/2020-2021-School-Quality-Reports-High-School/26je-vkp6)

```{r data-read-in}
# Read in our dataset from GitHub
# https://www.opendatanetwork.com/dataset/data.cityofnewyork.us/bm9v-cvch
df <- read.csv("../../data/school-quality-2020-2021.csv") #"https://data.cityofnewyork.us/api/views/26je-vkp6/rows.csv?date=20231108")
```


# Methodology



```{r, echo=FALSE, warning=FALSE}
label_cols <- c("dbn", "school_name", "school_type")
# Convert needed columns to numeric typing
df <- cbind(df[, label_cols], as.data.frame(lapply(df[,!names(df) %in% label_cols], as.numeric)))

df$college_rate <- df$val_persist3_4yr_all
df$economic_need <- df$eni_hs_pct_912
```

We create a 20% holdout set of data to be used later on in order to evaluate the efficacy of our model's predictive capability. The remaining 80% of the data is to be used for model training and exploratory data analysis (EDA).
```{r train-test-split}
set.seed(42)

# Adding a 20% holdout of our input data for model evaluation later
train <- subset(df[sample(1:nrow(df)), ]) %>% sample_frac(0.8)


test  <- dplyr::anti_join(df, train, by = 'dbn')
```


The below plot shows the raw relationship between each survey rating (*Collaborative Teaching*, *Trust*, etc) and the response variables of interest: *Average English/Math SAT scores* per school. 


```{r plot-relationships, warning=FALSE}

p1 <- ggplot(df, aes(x=survey_pp_CT, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y="Mean ACT Math Score")
p2 <- ggplot(df, aes(x=survey_pp_ES, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y=NULL)
p3 <- ggplot(df, aes(x=survey_pp_RI, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y=NULL)
p4 <- ggplot(df, aes(x=survey_pp_SE, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y=NULL)
p5 <- ggplot(df, aes(x=survey_pp_SF, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y=NULL)
p6 <- ggplot(df, aes(x=survey_pp_TR, y=val_mean_score_act_math_all)) + geom_point() + labs(x=NULL, y=NULL)

# Plot english scores
p7 <- ggplot(df, aes(x=survey_pp_CT, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Collaborative Teacher Rating",y="Mean ACT English Score")
p8 <- ggplot(df, aes(x=survey_pp_ES, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Leadership Rating", y=NULL)
p9 <- ggplot(df, aes(x=survey_pp_RI, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Rigorous Instruction", y=NULL)
p10 <- ggplot(df, aes(x=survey_pp_SE, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Supportive environment", y=NULL)
p11 <- ggplot(df, aes(x=survey_pp_SF, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Family-Community Ties", y=NULL)
p12 <- ggplot(df, aes(x=survey_pp_TR, y=val_mean_score_act_engl_all)) + geom_point() + labs(x="Trust", y=NULL)

# Panel plot
grid.arrange(
  p1, p2,
  p3, p4,
  p5, p6,
  p7, p8,
  p9, p10,
  p11, p12,
  nrow=2,
  ncol=6,
  top = "ACT Scores vs NYC School Quality Ratings, 2020-2021",
  bottom="Survey Rating Type"
)

```


# Experimentation and Results
First, we construct a basic linear model to predict both English and Math ACT average scores for a given school. 

```{r}
english_formula <- val_mean_score_act_engl_all ~ survey_pp_RI + survey_pp_CT + survey_pp_ES + survey_pp_SE + survey_pp_SF + survey_pp_TR

math_formula <-  val_mean_score_act_math_all ~ survey_pp_RI + survey_pp_CT + survey_pp_ES + survey_pp_SE + survey_pp_SF + survey_pp_TR

# Create lineaer model to predict english and math scores based on sruvey ratings
lm_english <- lm(english_formula, data=train)
lm_math <- lm(math_formula, data=train)
```


As we see from summary stats below $Rating \rightarrow English/Math$ models perform decently well at predicting ACT English and Math scores, respectively. We see adjusted $R^2$ values for each academic subject below:

- *English:* 0.76
- *Math:* 0.493

```{r}
summary(lm_english)
```


```{r}
summary(lm_math)
```


We can use two variables as a proxy for the school's survey rating in predicting college persistence:

- Percent in Temp Housing (`temp_housing_pct`) - percentage of students at a given school living in NYC temporary housing
- Economic Need Index (`eni_hs_pct_912`) - this is a measure of the percent of students facing economic hardship at a school

```{r}
hist(train$college_rate)
```

```{r}
ggplot(train, aes(x=temp_housing_pct)) + geom_histogram() + labs(x="% of Students in Temporary Housing", y="Number of NYC Schools")
```

First, we should check an assumption of linearity between our predictor and response variables.
```{r}

ggplot(train, aes(x=temp_housing_pct, y=college_rate)) + geom_point() + labs(x="% of Students in Temporary Housing", y="4-year College Persistence Rate")
```

We see a general linear relationship for schools with lower rates of students in temp housing. However, this linear relationship does **not** visually hold for schools with hisgher rates of temp housing use. 

Plotting the relationship below between a school's economic need index
```{r}

ggplot(train, aes(x=economic_need, y=college_rate)) + geom_point() +
  labs(x="Average Economic Need Index per School", y="4-year College Persistence Rate")
```
Again, we see a non-linear relationship between our predictor (*Economic Need Index*) and Outcome Variable (*College Persistence Rate*)

```{r}
proxy_lm <- lm(college_rate ~ temp_housing_pct + economic_need, train)
```


```{r}
plot(proxy_lm)
```


# Conclusion



## TODO
- Merge/Join in ACT/SAT information by DBN
- Model Selection

\newpage

# References

::: {#refs custom-style="Bibliography"}
:::


# Appendices

Below is the code used to generate this report. It's also available on [GitHub here](https://github.com/andrewbowen19/businessAnalyticsDataMiningDATA621/main)
```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```


